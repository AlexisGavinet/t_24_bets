<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Pronostics T24 BORMES 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
<style>
body { font-family: 'Roboto', sans-serif; background-color: #f4f4f9; margin:0; padding:20px; color:#333;}
h1 { text-align:center; color:#2c3e50; font-size:2.5em; margin-bottom:20px;}
.container { max-width:800px; margin:0 auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
label { display:block; margin-bottom:10px; font-weight:bold;}
select, input { width:100%; padding:10px; margin-bottom:20px; border-radius:4px; border:1px solid #ccc;}
button { width:100%; padding:12px; background-color:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; font-size:1em;}
button:hover { background-color:#218838;}
#podium { display:flex; flex-direction:column; gap:10px; margin-bottom:20px;}
.pillule { padding:10px 20px; background-color:#3498db; color:white; border-radius:20px; cursor:grab; text-align:center; user-select:none;}
.pillule:active { cursor:grabbing;}
.ghost { opacity:0.5; background-color:#ccc;}
.cadre-section { border:2px solid #000080; border-radius:15px; padding:5px; margin:20px 0; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.points-container { display:flex; gap:5px; align-items:stretch;}
.point-input { flex:1; display:flex; flex-direction:column; justify-content:space-between; border-radius:8px; padding:10px;}
.point-input label { font-weight:bold; margin-bottom:10px; text-align:center;}
.point-input input { width:100%; padding:5px; border-radius:4px; border:1px solid #ccc; text-align:center; margin-left:-5px;}
.tours-container { display:flex; gap:5px; align-items:stretch;}
.tour-input { flex:1; display:flex; flex-direction:column; justify-content:space-between; border-radius:8px; padding:0;}
.tour-input label { font-weight:bold; margin-bottom:10px; text-align:center;}
.tour-input select, .tour-input input { width:80%; padding:10px; border-radius:4px; border:1px solid #ccc; text-align:center; margin-left:10px;}
</style>
</head>
<body>
<div class="container">
<!--<h1>Pronostics T24 BORMES 2025</h1>-->
<div class="container">
<img alt="Image paris" src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/PARIS.jpg" style="width: 100%; border-radius: 15px; display: block; margin: 0 auto 20px;"/>
<form id="betForm">
<label for="participant">Votre nom :</label>
<select id="participant" name="participant" required>
    <option value="">Sélectionnez un participant</option>
    <option value="autre">Autre (saisir votre nom)</option>
</select>
<input type="text" id="customParticipant" name="customParticipant" placeholder="Saisissez votre nom" style="display:none;"/>

<label for="password">Mot de passe :</label>
<input type="password" id="password" name="password" required placeholder="Choisissez ou entrez votre mot de passe"/>

<!-- Podium -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/PODIUM.png" style="width:100%; border-radius:15px; margin-bottom:20px;">
<div id="podium">
<div class="pillule" data-team="Quadricolor...Les quatres couleurs primaires">Quadricolor...Les quatres couleurs primaires</div>
<div class="pillule" data-team="Les San'slips">Les San'slips</div>
<div class="pillule" data-team="La Pepouze team">La Pepouze team</div>
</div>
<label>Nombre de points par équipe :</label>
<div class="points-container">
<div class="point-input">
<label for="points_quadri">Quadricolor</label>
<input id="points_quadri" min="0" name="points_quadri" required type="number"/>
</div>
<div class="point-input">
<label for="points_san">Les San'slips</label>
<input id="points_san" min="0" name="points_san" required type="number"/>
</div>
<div class="point-input">
<label for="points_pep">La Pepouze team</label>
<input id="points_pep" min="0" name="points_pep" required type="number"/>
</div>
</div>
</div>

<!-- Natation -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/NATATION.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label for="meilleur-nageur-vitesse">Qui nagera le plus vite :</label>
<select id="meilleur-nageur-vitesse" name="meilleur-nageur-vitesse" required><option value="">Sélectionnez un participant</option></select>
<div class="tours-container">
<label for="meilleur-nageur-tours-nom">Qui fera le plus de tours :</label>
<select id="meilleur-nageur-tours-nom" name="meilleur-nageur-tours-nom" required><option value="">Sélectionnez un participant</option></select>
<input id="meilleur-nageur-tours-nombre" min="0" name="meilleur-nageur-tours-nombre" placeholder="Nombre de tours" required type="number"/>
</div>
</div>

<!-- Vélo -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/VELO.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label for="meilleur-rouleur-vitesse">Qui roulera le plus vite :</label>
<select id="meilleur-rouleur-vitesse" name="meilleur-rouleur-vitesse" required><option value="">Sélectionnez un participant</option></select>
<div class="tours-container">
<label for="meilleur-rouleur-tours-nom">Qui fera le plus de tours :</label>
<select id="meilleur-rouleur-tours-nom" name="meilleur-rouleur-tours-nom" required><option value="">Sélectionnez un participant</option></select>
<input id="meilleur-rouleur-tours-nombre" min="0" name="meilleur-rouleur-tours-nombre" placeholder="Nombre de tours" required type="number"/>
</div>
</div>

<!-- Course à pied -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/CAP.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label for="meilleur-coureur-vitesse">Qui courra le plus vite :</label>
<select id="meilleur-coureur-vitesse" name="meilleur-coureur-vitesse" required><option value="">Sélectionnez un participant</option></select>
<div class="tours-container">
<label for="meilleur-coureur-tours-nom">Qui fera le plus de tours :</label>
<select id="meilleur-coureur-tours-nom" name="meilleur-coureur-tours-nom" required><option value="">Sélectionnez un participant</option></select>
<input id="meilleur-coureur-tours-nombre" min="0" name="meilleur-coureur-tours-nombre" placeholder="Nombre de tours" required type="number"/>
</div>
</div>

<!-- Autres paris -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/CIG.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label for="meilleur-fumeur">Plus de clopes fumées :</label>
<select id="meilleur-fumeur" name="meilleur-fumeur" required><option value="">Sélectionnez un participant</option></select>
<label for="meilleur-buveur">Plus de bières descendues :</label>
<select id="meilleur-buveur" name="meilleur-buveur" required><option value="">Sélectionnez un participant</option></select>
</div>

<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/SLEEP.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label for="plus-gros-dormeur">Plus gros dormeur :</label>
<select id="plus-gros-dormeur" name="plus-gros-dormeur" required><option value="">Sélectionnez un participant</option></select>
</div>

<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/DNF.jpg" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label>Qui abandonnera ?</label>
<label for="abandon-blessure">Blessure / Fatigue :</label>
<select id="abandon-blessure" name="abandon-blessure" required><option value="">Sélectionnez un participant</option></select>
<label for="abandon-meteo">Méteo :</label>
<select id="abandon-meteo" name="abandon-meteo" required><option value="">Sélectionnez un participant</option></select>
</div>

<!-- Ton meilleur temps et nombre de tours -->
<div class="cadre-section">
<img src="https://raw.githubusercontent.com/AlexisGavinet/t_24_bets/main/PERSO.png" style="width:100%; border-radius:15px; margin-bottom:20px;">
<label>Ton meilleur temps : </label>
<div class="points-container">
<div class="point-input">
<label for="points_perso_nat">Natation</label>
<input id="points_perso_nat" min="0" name="points_perso_nat" required type="number"/>
</div>
<div class="point-input">
<label for="points_perso_velo">Vélo</label>
<input id="points_perso_velo" min="0" name="points_perso_velo" required type="number"/>
</div>
<div class="point-input">
<label for="points_perso_cap">Course à pieds</label>
<input id="points_perso_cap" min="0" name="points_perso_cap" required type="number"/>
</div>
</div>
<label>Ton nombre de tours : </label>
<div class="points-container">
<div class="point-input">
<label for="tour_perso_nat">Natation</label>
<input id="tour_perso_nat" min="0" name="tour_perso_nat" required type="number"/>
</div>
<div class="point-input">
<label for="tour_perso_velo">Vélo</label>
<input id="tour_perso_velo" min="0" name="tour_perso_velo" required type="number"/>
</div>
<div class="point-input">
<label for="tour_perso_cap">Course à pieds</label>
<input id="tour_perso_cap" min="0" name="tour_perso_cap" required type="number"/>
</div>
</div>
</div>

<button type="submit">Soumettre le pari</button>
</form>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyDIClGO9pdfLBDmNHtTFAxgrzx45d4H7rk",
    authDomain: "paris-du-t24.firebaseapp.com",
    databaseURL: "https://paris-du-t24-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "paris-du-t24",
    storageBucket: "paris-du-t24.firebasedatabase.app",
    messagingSenderId: "726232759474",
    appId: "1:726232759474:web:b6c56cf19fedfe8e489dab",
    measurementId: "G-3FVQ4L7M5W"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// Deux listes distinctes - initialement identiques
let participantsPourParieurs = ["LeBatou8","Pejos","Teddy","La Bourle","Kresp","Max Mo","Sancy","JuJu","La Roume","Tut","LaGav","La Tote"];
let participantsPourPronostics = ["LeBatou8","Pejos","Teddy","La Bourle","Kresp","Max Mo","Sancy","JuJu","La Roume","Tut","LaGav","La Tote"];

const participantSelect = document.getElementById('participant');
const customParticipantInput = document.getElementById('customParticipant');

// Fonction pour charger les participants depuis Firebase
async function loadParticipants() {
    try {
        const participantsRef = ref(database, 'participants');
        const snapshot = await get(participantsRef);
        
        if (snapshot.exists()) {
            const participantsData = snapshot.val();
            // Convertir l'objet en tableau
            const participantsArray = Object.values(participantsData);
            
            participantsPourParieurs = [...new Set([...participantsPourParieurs, ...participantsArray])];
            participantsPourPronostics = [...new Set([...participantsPourPronostics, ...participantsArray])];
            
            console.log("Participants chargés:", participantsPourParieurs);
            
            // Mettre à jour les dropdowns
            updateAllDropdowns();
        }
    } catch (error) {
        console.error("Erreur lors du chargement des participants:", error);
    }
}

// Fonction pour mettre à jour tous les dropdowns
function updateAllDropdowns() {
    fillDropdown(participantSelect, participantsPourParieurs, true);
    
    const allDropdowns = [
        'meilleur-nageur-vitesse',
        'meilleur-nageur-tours-nom',
        'meilleur-rouleur-vitesse',
        'meilleur-rouleur-tours-nom',
        'meilleur-coureur-vitesse',
        'meilleur-coureur-tours-nom',
        'meilleur-fumeur',
        'meilleur-buveur',
        'plus-gros-dormeur',
        'abandon-blessure',
        'abandon-meteo'
    ];

    allDropdowns.forEach(dropdownId => {
        const dropdown = document.getElementById(dropdownId);
        if (dropdown) {
            fillDropdown(dropdown, participantsPourPronostics, false);
        }
    });
}

// Fonction pour sauvegarder un nouveau participant
async function saveNewParticipant(newParticipant) {
    try {
        const participantsRef = ref(database, 'participants');
        const snapshot = await get(participantsRef);
        
        let participantsList = [];
        if (snapshot.exists()) {
            participantsList = Object.values(snapshot.val());
        }
        
        // Ajouter le nouveau participant s'il n'existe pas déjà
        if (!participantsList.includes(newParticipant)) {
            participantsList.push(newParticipant);
            
            // Convertir en objet pour Firebase
            const participantsObject = {};
            participantsList.forEach((participant, index) => {
                participantsObject[index] = participant;
            });
            
            await set(participantsRef, participantsObject);
            console.log("Nouveau participant sauvegardé:", newParticipant);
            return true;
        }
        console.log("Participant déjà existant:", newParticipant);
        return false;
    } catch (error) {
        console.error("Erreur lors de la sauvegarde du participant:", error);
        return false;
    }
}

// Fonction pour remplir un dropdown avec les participants
function fillDropdown(selectElement, participantsList, includeOtherOption = false) {
    // Sauvegarder la valeur sélectionnée
    const selectedValue = selectElement.value;
    
    // Vider le dropdown sauf la première option
    while (selectElement.children.length > 1) {
        selectElement.removeChild(selectElement.lastChild);
    }
    
    // Ajouter tous les participants
    participantsList.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        selectElement.appendChild(opt);
    });
    
    // Ajouter l'option "Autre" si demandé
    if (includeOtherOption) {
        const otherOpt = document.createElement('option');
        otherOpt.value = 'autre';
        otherOpt.textContent = 'Autre (saisir votre nom)';
        selectElement.appendChild(otherOpt);
    }
    
    // Restaurer la sélection si possible
    if (selectedValue && participantsList.includes(selectedValue)) {
        selectElement.value = selectedValue;
    }
}

// Initialiser l'application
async function initApp() {
    await loadParticipants();
    updateAllDropdowns();
}

// Appeler l'initialisation au chargement
initApp();

// Gérer l'affichage du champ personnalisé
participantSelect.addEventListener('change', function() {
    if (this.value === 'autre') {
        customParticipantInput.style.display = 'block';
        customParticipantInput.required = true;
    } else {
        customParticipantInput.style.display = 'none';
        customParticipantInput.required = false;
    }
});

// Sortable podium
const podium = document.getElementById('podium');
Sortable.create(podium, {animation:150, ghostClass:'ghost'});

// Formulaire
document.getElementById('betForm').addEventListener('submit', async function(e){
    e.preventDefault();
    
    let participant;
    let isNewParticipant = false;
    
    if (participantSelect.value === 'autre') {
        participant = customParticipantInput.value.trim();
        if (!participant) {
            alert("Veuillez saisir votre nom");
            return;
        }
        isNewParticipant = true;
    } else {
        participant = participantSelect.value;
    }
    
    const password = document.getElementById('password').value;
    const podiumTeams = Array.from(podium.children).map(el=>el.dataset.team);
    const [firstPlace, secondPlace, thirdPlace] = podiumTeams;
    if(!firstPlace || !secondPlace || !thirdPlace){ alert("Veuillez définir l'ordre du podium"); return; }

    const betRef = ref(database, 'bets/' + participant);
    const snapshot = await get(betRef);

    if(snapshot.exists() && snapshot.val().password !== password){
        alert("Mot de passe incorrect pour ce participant"); 
        return;
    }

    // Sauvegarder le nouveau participant si c'est un nouveau nom
    if (isNewParticipant) {
        const saved = await saveNewParticipant(participant);
        if (saved) {
            // Recharger la liste des participants
            await loadParticipants();
        }
    }

    const betData = {
        participant,
        password,
        firstPlace, secondPlace, thirdPlace,
        points_quadri: document.getElementById('points_quadri').value,
        points_san: document.getElementById('points_san').value,
        points_pep: document.getElementById('points_pep').value,
        meilleurNageurVitesse: document.getElementById('meilleur-nageur-vitesse').value,
        meilleurNageurToursNom: document.getElementById('meilleur-nageur-tours-nom').value,
        meilleurNageurToursNombre: document.getElementById('meilleur-nageur-tours-nombre').value,
        meilleurRouleurVitesse: document.getElementById('meilleur-rouleur-vitesse').value,
        meilleurRouleurToursNom: document.getElementById('meilleur-rouleur-tours-nom').value,
        meilleurRouleurToursNombre: document.getElementById('meilleur-rouleur-tours-nombre').value,
        meilleurCoureurVitesse: document.getElementById('meilleur-coureur-vitesse').value,
        meilleurCoureurToursNom: document.getElementById('meilleur-coureur-tours-nom').value,
        meilleurCoureurToursNombre: document.getElementById('meilleur-coureur-tours-nombre').value,
        meilleurFumeur: document.getElementById('meilleur-fumeur').value,
        meilleurBuveur: document.getElementById('meilleur-buveur').value,
        plusGrosDormeur: document.getElementById('plus-gros-dormeur').value,
        abandonBlessure: document.getElementById('abandon-blessure').value,
        abandonMeteo: document.getElementById('abandon-meteo').value,
        points_perso_nat: document.getElementById('points_perso_nat').value,
        points_perso_velo: document.getElementById('points_perso_velo').value,
        points_perso_cap: document.getElementById('points_perso_cap').value,
        tour_perso_nat: document.getElementById('tour_perso_nat').value,
        tour_perso_velo: document.getElementById('tour_perso_velo').value,
        tour_perso_cap: document.getElementById('tour_perso_cap').value,
        timestamp: new Date().toISOString()
    };

    set(betRef, betData).then(()=>{ 
        alert(`Merci ${participant} pour ton pari !`);
        // Réinitialiser le formulaire
        document.getElementById('betForm').reset();
        customParticipantInput.style.display = 'none';
    })
    .catch(err=>{ console.error(err); alert("Erreur lors de l'enregistrement"); });
});
</script>
</body>
</html>

